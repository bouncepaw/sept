#!/usr/bin/env ruby

%w(sept colorize json).each { |f| require f }

def validate_list_of_files(list_of_files)
  correct_ones = []
  list_of_files.each do |file|
    if %w(.septh .septc).include? file
      correct_ones << file
    else
      puts "ERROR #{file} is not a Sept file. Use `.septh` or `.septc`".red
    end
  end
end

if ARGV.length == 0
  puts "ERROR No arguments passed!".red
  exit 1
else
  case ARGV[0]
  when '-h', '--help' # help
    puts File.read 'HELP_MESSAGE'
  when '-v', '--version'
    # TODO: fetch version from sept.gemspec automatically
    puts "SEPT HTML version 1.4.2"
  when '-d', '--data'
    puts "Passed data as argument".light_blue
    params = JSON.parse ARGV[1]
    list_of_files = validate_list_of_files ARGV[2..-1]
  when '-f', '--file'
    puts "Passed data as file".light_blue
    params = JSON.parse File.read ARGV[1]
    list_of_files = validate_list_of_files ARGV[2..-1]
  else
    puts "No passed data".light_blue
    params = {}
    list_of_files = validate_list_of_files ARGV
  end
end

sept = Sept.new(params, list_of_files)
